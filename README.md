# sync-subdir

ä¸€ä¸ªä½¿ç”¨ Rust å’Œ TUI æŠ€æœ¯å®ç°çš„å­ç›®å½•å˜æ›´åŒæ­¥å·¥å…·ï¼Œç”¨äºå°†æºä»“åº“ä¸­æŸä¸ªå­ç›®å½•çš„å˜æ›´åŒæ­¥åˆ°ç‹¬ç«‹çš„ç›®æ ‡ä»“åº“ã€‚

## ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½** - ä½¿ç”¨ Rust å®ç°ï¼Œæ¯”åŸ bash è„šæœ¬å¿«æ•°å€
- ğŸ¨ **äº¤äº’å¼ TUI** - ç¾è§‚çš„ç»ˆç«¯ç•Œé¢ï¼Œæ”¯æŒå®æ—¶è¿›åº¦æ˜¾ç¤º
- ğŸ”§ **çµæ´»é…ç½®** - æ”¯æŒåˆ†æ”¯ç®¡ç†ã€commit èŒƒå›´é€‰æ‹©ç­‰é«˜çº§é€‰é¡¹
- ğŸ“Š **è¯¦ç»†ç»Ÿè®¡** - æ˜¾ç¤ºæ–‡ä»¶å˜æ›´ç»Ÿè®¡å’ŒåŒæ­¥ç»“æœ
- ğŸ›¡ï¸ **å®‰å…¨å¯é ** - å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œå›æ»šæœºåˆ¶
- ğŸŒ **è·¨å¹³å°** - æ”¯æŒ Linuxã€macOS å’Œ Windows

## å®‰è£…

### ä»æºç ç¼–è¯‘

```bash
git clone https://github.com/your-repo/sync-subdir-rs.git
cd sync-subdir-rs
cargo build --release
```

ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶ä½äº `target/release/sync-subdir`ã€‚

### ä½¿ç”¨ Cargo å®‰è£…

```bash
cargo install sync-subdir
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# åŒæ­¥æºä»“åº“çš„ src å­ç›®å½•åˆ°ç›®æ ‡ä»“åº“
sync-subdir /path/to/source/repo src /path/to/target/repo abc123

# æŒ‡å®šæºåˆ†æ”¯
sync-subdir -b feature/new-feature /repo/main submodule /repo/sub abc123

# æ’é™¤ merge æäº¤
sync-subdir -n /repo/main src /repo/sub abc123
```

### å‘½ä»¤è¡Œé€‰é¡¹

```
ç”¨æ³•: sync-subdir [é€‰é¡¹] <æºä»“åº“> <å­ç›®å½•> <ç›®æ ‡ä»“åº“> <èµ·å§‹commit>

å‚æ•°:
    æºä»“åº“        æº Git ä»“åº“è·¯å¾„
    å­ç›®å½•        æºä»“åº“ä¸­è¦åŒæ­¥çš„å­ç›®å½•åç§°
    ç›®æ ‡ä»“åº“      ç›®æ ‡ Git ä»“åº“è·¯å¾„
    èµ·å§‹commit    èµ·å§‹ commit hash

é€‰é¡¹:
    -b, --source-branch <åˆ†æ”¯>       æºä»“åº“åˆ†æ”¯ (é»˜è®¤: å½“å‰åˆ†æ”¯)
    -t, --target-branch <åˆ†æ”¯>       ç›®æ ‡ä»“åº“åˆ†æ”¯ (é»˜è®¤: ä¸æºåˆ†æ”¯åŒå)
    -e, --end <commit>              ç»“æŸ commit (é»˜è®¤: HEAD)
    -c, --create-branch              è‡ªåŠ¨åˆ›å»ºç›®æ ‡åˆ†æ”¯
    --no-create-branch               ç¦æ­¢è‡ªåŠ¨åˆ›å»ºç›®æ ‡åˆ†æ”¯
    -i, --include-start              åŒ…å«èµ·å§‹ commit çš„å˜æ›´
    --no-include-start               ä¸åŒ…å«èµ·å§‹ commit çš„å˜æ›´
    -n, --no-merge                  æ’é™¤ merge å¼•å…¥çš„å˜æ›´
    --delete                        åŒæ­¥åˆ é™¤æ“ä½œ
    --no-delete                     ä¸åŒæ­¥åˆ é™¤æ“ä½œ
    --stash                         è‡ªåŠ¨ stash ç›®æ ‡ä»“åº“æœªæäº¤å˜æ›´
    -d, --dry-run                   é¢„è§ˆæ¨¡å¼ï¼Œä¸å®é™…æ‰§è¡Œ
    -v, --verbose                   è¯¦ç»†è¾“å‡º
    -y, --yes                       è·³è¿‡ç¡®è®¤ï¼Œä½¿ç”¨é»˜è®¤å€¼
    -h, --help                      æ˜¾ç¤ºå¸®åŠ©
```

## TUI ç•Œé¢

ç¨‹åºå¯åŠ¨åä¼šæ˜¾ç¤ºäº¤äº’å¼ TUI ç•Œé¢ï¼ŒåŒ…å«ä»¥ä¸‹å±å¹•ï¼š

### 1. é…ç½®å®¡æŸ¥
æ˜¾ç¤ºå½“å‰çš„åŒæ­¥é…ç½®ï¼ŒåŒ…æ‹¬æº/ç›®æ ‡ä»“åº“ã€å­ç›®å½•è·¯å¾„ã€commit èŒƒå›´ç­‰ã€‚

### 2. æ–‡ä»¶é€‰æ‹©
åˆ—å‡ºæ‰€æœ‰å¾…åŒæ­¥çš„æ–‡ä»¶ï¼Œä½¿ç”¨ä¸åŒé¢œè‰²æ ‡è¯†æ–‡ä»¶çŠ¶æ€ï¼š
- ğŸŸ¢ ç»¿è‰²ï¼šæ–°å¢æ–‡ä»¶
- ğŸŸ¡ é»„è‰²ï¼šä¿®æ”¹æ–‡ä»¶
- ğŸ”´ çº¢è‰²ï¼šåˆ é™¤æ–‡ä»¶
- ğŸ”µ è“è‰²ï¼šé‡å‘½åæ–‡ä»¶

**æ“ä½œè¯´æ˜ï¼š**
- `â†‘/â†“` - å¯¼èˆªæ–‡ä»¶åˆ—è¡¨
- `Space` - é€‰æ‹©/å–æ¶ˆé€‰æ‹©æ–‡ä»¶
- `a` - å…¨é€‰æ–‡ä»¶
- `A` - å–æ¶ˆå…¨é€‰
- `Enter` - å¼€å§‹åŒæ­¥
- `q` - é€€å‡ºç¨‹åº

### 3. åŒæ­¥è¿›åº¦
å®æ—¶æ˜¾ç¤ºåŒæ­¥è¿›åº¦æ¡å’Œå½“å‰æ“ä½œçš„æ–‡ä»¶ã€‚

### 4. å®Œæˆ
æ˜¾ç¤ºåŒæ­¥ç»“æœç»Ÿè®¡ï¼ŒåŒ…æ‹¬æˆåŠŸã€å¤±è´¥ã€è·³è¿‡çš„æ–‡ä»¶æ•°é‡ã€‚

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1ï¼šåŒæ­¥æ¨¡å—åˆ°ç‹¬ç«‹ä»“åº“

```bash
# å°†ä¸»ä»“åº“çš„ utils æ¨¡å—åŒæ­¥åˆ°ç‹¬ç«‹çš„ utils ä»“åº“
sync-subdir \
    /projects/main-repo \
    utils \
    /projects/utils-repo \
    abc123def456
```

### åœºæ™¯ 2ï¼šå¤„ç†åˆ†æ”¯å’Œ merge

```bash
# åŒæ­¥ç‰¹å®šåˆ†æ”¯ï¼Œæ’é™¤ merge æäº¤
sync-subdir \
    -b feature/api-refactor \
    -n \
    /projects/backend \
    api \
    /projects/api-service \
    xyz789abc012
```

### åœºæ™¯ 3ï¼šé¢„è§ˆæ¨¡å¼

```bash
# æŸ¥çœ‹å°†è¦åŒæ­¥çš„æ–‡ä»¶ï¼Œä½†ä¸å®é™…æ‰§è¡Œ
sync-subdir \
    -d \
    /projects/monorepo \
    frontend \
    /projects/frontend-repo \
    def456ghi789
```

## å·¥ä½œæµç¨‹

1. **å‚æ•°éªŒè¯** - éªŒè¯ä»“åº“è·¯å¾„ã€commit hash ç­‰å‚æ•°
2. **åˆ†æ”¯ç®¡ç†** - åˆ‡æ¢åˆ°æŒ‡å®šåˆ†æ”¯ï¼Œåˆ›å»ºç›®æ ‡åˆ†æ”¯ï¼ˆå¦‚æœéœ€è¦ï¼‰
3. **å˜æ›´æ£€æµ‹** - åˆ†ææŒ‡å®š commit èŒƒå›´å†…çš„æ–‡ä»¶å˜æ›´
4. **äº¤äº’å¼é€‰æ‹©** - åœ¨ TUI ç•Œé¢ä¸­é€‰æ‹©è¦åŒæ­¥çš„æ–‡ä»¶
5. **æ‰§è¡ŒåŒæ­¥** - å¤åˆ¶æ–‡ä»¶ã€å¤„ç†åˆ é™¤æ“ä½œ
6. **ç»“æœæŠ¥å‘Š** - æ˜¾ç¤ºåŒæ­¥ç»“æœç»Ÿè®¡

## é«˜çº§ç‰¹æ€§

### è‡ªåŠ¨ Stash
å¦‚æœç›®æ ‡ä»“åº“æœ‰æœªæäº¤çš„å˜æ›´ï¼Œå¯ä»¥è‡ªåŠ¨ stash è¿™äº›å˜æ›´ï¼š
```bash
sync-subdir --stash /repo/main src /repo/sub abc123
```

### æ’é™¤ Merge æäº¤
åªåŒæ­¥ç›´æ¥æäº¤çš„å˜æ›´ï¼Œæ’é™¤é€šè¿‡ merge å¼•å…¥çš„å˜æ›´ï¼š
```bash
sync-subdir -n /repo/main src /repo/sub abc123
```

### åˆ é™¤æ“ä½œæ§åˆ¶
å¯ä»¥é€‰æ‹©æ˜¯å¦åŒæ­¥æ–‡ä»¶åˆ é™¤æ“ä½œï¼š
```bash
sync-subdir --no-delete /repo/main src /repo/sub abc123
```

## é”™è¯¯å¤„ç†

ç¨‹åºåŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

- **å‚æ•°éªŒè¯é”™è¯¯** - æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯å’Œä¿®å¤å»ºè®®
- **Git æ“ä½œé”™è¯¯** - è‡ªåŠ¨æ¢å¤åˆ°åŸå§‹åˆ†æ”¯çŠ¶æ€
- **æ–‡ä»¶ç³»ç»Ÿé”™è¯¯** - è¯¦ç»†çš„é”™è¯¯ä¸Šä¸‹æ–‡å’Œæ–‡ä»¶è·¯å¾„
- **æƒé™é”™è¯¯** - æ˜ç¡®çš„æƒé™é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

## æ€§èƒ½ä¼˜åŒ–

- **å¼‚æ­¥ I/O** - ä½¿ç”¨ tokio å®ç°éé˜»å¡æ–‡ä»¶æ“ä½œ
- **æ‰¹é‡å¤„ç†** - ä¼˜åŒ–æ–‡ä»¶å¤åˆ¶å’Œç›®å½•åˆ›å»ºæ“ä½œ
- **å†…å­˜æ•ˆç‡** - æµå¼å¤„ç†å¤§å‹å˜æ›´åˆ—è¡¨
- **è¿›åº¦åé¦ˆ** - å®æ—¶æ˜¾ç¤ºæ“ä½œè¿›åº¦

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ‰¾ä¸åˆ° git å‘½ä»¤**
   ```
   é”™è¯¯: Failed to open git repository
   è§£å†³: ç¡®ä¿å®‰è£…äº† git å¹¶ä¸”è·¯å¾„æ­£ç¡®
   ```

2. **æƒé™ä¸è¶³**
   ```
   é”™è¯¯: Permission denied
   è§£å†³: æ£€æŸ¥æ–‡ä»¶å’Œç›®å½•çš„è¯»å†™æƒé™
   ```

3. **åˆ†æ”¯ä¸å­˜åœ¨**
   ```
   é”™è¯¯: Branch 'feature/xyz' does not exist
   è§£å†³: ä½¿ç”¨ -c é€‰é¡¹è‡ªåŠ¨åˆ›å»ºåˆ†æ”¯
   ```

### è°ƒè¯•æ¨¡å¼

ä½¿ç”¨ `--verbose` é€‰é¡¹è·å–è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼š
```bash
sync-subdir -v /repo/main src /repo/sub abc123
```

## å¼€å‘

### é¡¹ç›®ç»“æ„

```
sync-subdir-rs/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs      # ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ cli.rs       # å‘½ä»¤è¡Œå‚æ•°è§£æ
â”‚   â”œâ”€â”€ git.rs       # Git æ“ä½œå°è£…
â”‚   â”œâ”€â”€ tui.rs       # TUI ç•Œé¢å®ç°
â”‚   â””â”€â”€ sync.rs      # æ–‡ä»¶åŒæ­¥å¼•æ“
â”œâ”€â”€ Cargo.toml       # é¡¹ç›®é…ç½®
â””â”€â”€ README.md        # é¡¹ç›®æ–‡æ¡£
```

### è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ Pull Request

### æµ‹è¯•

è¿è¡Œæµ‹è¯•å¥—ä»¶ï¼š
```bash
cargo test
```

è¿è¡Œé›†æˆæµ‹è¯•ï¼š
```bash
cargo test --test integration
```

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## è‡´è°¢

æœ¬å·¥å…·å—åŸ `sync-subdir-changes.sh` è„šæœ¬å¯å‘ï¼Œä½¿ç”¨ Rust é‡æ–°å®ç°ï¼Œæå‡äº†æ€§èƒ½å’Œç”¨æˆ·ä½“éªŒã€‚

## ç›¸å…³é“¾æ¥

- [Rust å®˜ç½‘](https://www.rust-lang.org/)
- [ratatui TUI æ¡†æ¶](https://github.com/ratatui-org/ratatui)
- [git2 Rust ç»‘å®š](https://github.com/rust-lang/git2-rs)